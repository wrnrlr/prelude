<!DOCTYPE html>
<head>
<title>Prelude</title>
<link href="./presets.css" rel="stylesheet" />
<link href="https://unpkg.com/prismjs@1.29.0/themes/prism.css" rel="stylesheet" />
<script src="https://unpkg.com/prismjs@1.29.0/components/prism-core.min.js"></script>
<script src="https://unpkg.com/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EPMJYD1EK8"></script>
<script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-EPMJYD1EK8');</script>
</head>

<nav class="flex p-2 justify-between">
  <div class="flex items-center gap-3">
    <svg viewBox="0 0 709 709" style="--color:var(--neutral-900)"><use xlink:href="./logo.svg#loop"></use></svg>
    <span class="prelude text-2xl">Prelude</span>
  </div>
  <div class="flex items-center gap-5">
    <a href="docs/index.html">Get Started</a>
    <a href="docs/modules.html">API</a>
    <button class="button playground">Playground</button>
  </div>
</nav>

<div id="playground"></div>

<main>
<section class="flex column items-center py-8">
  <svg class="py-8" viewBox="0 0 709 709" style="width:300px;--color:var(--neutral-700)"><use xlink:href="./logo.svg#loop"></use></svg>
  <div class="flex column center items-center gap-6">
    <span class="prelude text-6xl">Prelude</span>
    <span class="text-3xl">A signal-based web library that lets you <br> develop in a familiar functional style</span>
    <div class="flex gap-4">
        <a class="button text-xl" href="docs/index.html">Get Started</a>
        <button class="button text-xl playground">Open Playground</button>
    </div>
  </div>
</section>

<section class="flex column items-center py-8 gap-8">
  <h1 class="center text-5xl">Just write JavaScript!</h1>
  <p class="center text-2xl">Instead of JSX, Prelude uses HyperScript,<br>
      a DSL that lets you defined components in JavaScript.</p>
  <div class="flex items-center content-center gap-8">
    <pre><code class="language-js">import {h, signal, render} from 'prelude'

function Counter() {
  const n = signal(1)
  const onClick = e => n(i => i+1)
  return h('button', {onClick}, n)
}

render(Counter, window.counter)</code></pre>
    <div class="card">
        <div class="title center">Counter</div>
        <div class="flex justify-center content-center flex-wrap content" id="counter"></div>
    </div>
  </div>
  <div class="flex column gap-4 items-start text-xl pl-10">
    <p>Create a reactive value with <code class="language-js">const n = signal(1)</code>.</p>
    <p>Define an event handler that increments the signal <code class="language-js">n(i=>i+1)</code>.</p>
    <p>The function returned from <code class="language-js">h(...)</code> will render a HTML button <br>
        that handles <code class="language-js">onclick</code> events and displays the counter value.</p>
    <p>Prelude has fine-grained reactivity and will only update<br>those parts of the DOM that needs to be changed.</p>
  </div>
</section>

<section class="flex column items-center py-8">
    <p class="center text-2xl">Try in your Browser</p>
    <div class="flex items-center gap-4 pt-6">
      <button class="button text-md playground">Open Playground</button>
    </div>
</section>

<footer class="flex px-2 py-2 gap-8" style="background-color: var(--neutral-100);">
  <div class="flex column justify-center gap-3">
    <a href="https://npm.com/@wrnrlr/prelude">NPM</a>
    <a href="https://jsr.io/@wrnrlr/prelude">JSR</a>
  </div>
  <div class="flex column justify-center gap-3">
      <a href="https://x.com/wrnrlr">Twitter</a>
      <a href="https://discord.gg/N3gPZnhdKV">Discord</a>
  </div>
  <div class="flex column-reverse center grow">Some rights reserved &copy; 2024</div>
  <svg viewBox="0 0 709 709" style="width: 100px; --color:var(--neutral-700)"><use xlink:href="./logo.svg#loop"></use></svg>
</footer>
</main>

<style >
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Warang+Citi&display=swap');

html {
  font-size: 20px;
  /* font-family: "Noto Sans Warang Citi", sans-serif; */
  font-weight: 400;
  font-style: normal;
  margin: 0;
  display: flex;
  width: 100%;
  height: 100%;
  color: var(--neutral-900);
}

body {
  display: flex;
  flex-direction: column;
  margin: 0;
  flex-grow: 2;
  width: 100%;
  height: 100%;
}

main {
    display: flex;
    flex-direction: column;
  gap: 1rem;
}

/* a { color: dodgerblue; } */
a:visited { color: black; }

/* h1 { font-size: 2.5rem; color: var(--neutral-900); font-weight: bolder; padding-top: 1rem } */
/* h2 { font-size: 2rem; color: var(--neutral-700); line-height: 1.5; padding-top: 0.8rem } */

section {
}
section:nth-child(1) { background-color: var(--neutral-100); }
/* section:nth-child(even) { background-color: var(--neutral-100); } */
/* section:nth-child(odd) { background-color: var(--neutral-200); } */

section > .wrapper { width: 700px }
section > .wide.wrapper { width: 900px }

button.playground {
    color: var(--neutral-50);
    background-color: var(--green-600);
    text-shadow: 0px 0px 3px var(--emrald-800);
    cursor: pointer;
}

#playground {
    display: flex;
    width: 100%;
    height: 100%;
    background-color: var(--neutral-50);
}

#playground.playing {
    display: flex;
}

.prelude {
  color: var(--neutral-700);
  font-weight: norma;
}

.button {
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  background-color: var(--neutral-200);
  font-weight: 600;
}

#counter > button {
    color: var(--neutral-50);
    font-weight: 800;
    padding: 1rem 1.5rem;
    border: 1px solid var(--blue-600);
    border-radius: 0.5rem;
    background-color: var(--blue-600);
    height: fit-content;
    min-width: 4.2rem;
    text-align: center;
    text-shadow: 0px 0px 3px var(--blue-800);
}

#counter > button:hover {
    background-color: var(--blue-500);
}

.card {
  width: 20rem;
  display: flex;
  flex-direction: column;
}

.card > .title {
  font-weight: bold;
  color: var(--gray-700);
  padding: 0.5em;
  background-color: var(--gray-300);
  border-radius: 0.5em 0.5em 0 0;
}

.card > .content {
  height: 220px;
  background-color: var(--gray-200);
}

a.card {
  text-decoration: none;
}

.w-half { width: 50% }
.CodeMirror { height: 100%; }
</style>

<script type="module">
import {h, signal, effect, untrack, resource, render, onMount, Show, List, Router} from './src/mod.ts'
import {EditorView, basicSetup} from "codemirror"
import {javascript} from "@codemirror/lang-javascript"
import {html} from "@codemirror/lang-html"

function Counter() {
  const n = signal(1)
  const onClick = e => n(i => i+1)
  return h('button', {onClick}, n)
}

render(Counter, window.counter)

const playing = signal(true)
const examples = [
  {name:'counter.html',title:'Counter'},
  {name:'todo.html',title:'Todo'},
  {name:'admin.html',title:'Admin'}
]

// <svg viewBox="0 0 709 709" style="width: 100px; --color:var(--neutral-700)">
// <use xlink:href="./logo.svg#loop"></use></svg>
function PreludeLogo() {
  return h('svg', {viewBox:'0 0 709 709',style:'width: 50px; --color:var(--neutral-700)'},
    h('use', {'xlink:href':'./logo.svg#loop'}))
}

// <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"/></svg>
function MenuIcon() {
  return h('svg', {xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 448 512',style:'width: 20px; --color:var(--neutral-700)'},
    h('path',{d:'M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z'}))
}

// <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>
function CloseIcon() {
  return h('svg', {xmlns:'http://www.w3.org/2000/svg', viewBox:'0 0 384 512',style:'width: 20px; --color:var(--neutral-700)'},
    h('path',{d:'M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z'}))
}

function Editor(props) {
  const theme = EditorView.baseTheme({
    'cm-editor': {display:'flex', height:'100%',backgroundColor:'lightpink'},
    // '&': { maxHeight: '200px' },
    '.cm-gutter,.cm-content': {minHeight: '100px', height:'100%'},
    '.cm-scroller': {overflow: 'auto', height:'100%', flexGrow:1, backgroundColor:'' },
  })
  const ref = e => {
    let updateListenerExtension = EditorView.updateListener.of((update) => {
      if (update.docChanged) {
        console.log('doc change',update.state.doc.toString())
        props.value(update.state.doc.toString())
        // Handle the event here
      }
    });
    let editor = new EditorView({
      doc:props.value(),
      extensions: [basicSetup, theme, html(), updateListenerExtension],
      parent: e
    })
    effect(()=>{
      console.log('effective!')
      props.src(),props.file()
      const insert = untrack(props.value)
      editor.dispatch({changes: {from: 0, to: editor.state.doc.length, insert}})
    })
  }
  return h('.p-1.w-half.h-full',{ref,style:'background-color:var(--stone-100)'})
}

function Preview(props) {
  return h('iframe.w-half',{style:'background-color:var(--gray-300)',srcdoc:props.value},'Hello')
}

function TopMenu(props) {
  return h('.flex.p-2.gap-2',{style:'background-color:var(--neutral-200)'},[
    h(Show, {when:()=>!props.show()}, [
      h(PreludeLogo),
      h('button.button', {onClick:e=>(props.show(b=>!b))},h(MenuIcon)),
    ]),
    h('input.grow', {value:'Example #1'}),
    h('button.button', {onClick:e=>(props.playing(b=>!b))},h(CloseIcon))])
}

function SrcMenu(props) {
  effect(()=>console.log(props.src()===props.name))
  return h('.flex.column.gap-1',[
    h('button.flex.font-weight-600', {onClick:e=>props.src(props.name)}, props.title),
    h(Show,{when:()=>props.src()===props.name},
      h('.flex.column.gap-1.pl-2',
        h(List, {each:()=>props.items}, (value,i) =>
          h('button.flex',{onClick:e=>props.file(value().name)},h('',()=>value().title))
        )
      )
    )])
}

function SideMenu(props) {
  return h('.flex.column.px-2.py-2.gap-4',{style:'background-color:var(--neutral-300)'},[
    h('.flex', [
      h(PreludeLogo),
      h('button.button', {onClick:e=>(props.show(b=>!b)),style:'background-color:var(--neutral-300)'}, h(CloseIcon)),
    ]),
    h('.flex.column.gap-2', [
      h(SrcMenu,{name:'example',title:'Example',file:()=>props.file,items:()=>()=>examples,src:()=>props.src}),
      h(SrcMenu,{name:'local',title:'Local Storage',file:()=>props.file,items:()=>props.local,src:()=>props.src})
    ])
  ])
}

function Playground() {
  const show = signal(true)
  const src = signal('example')
  const file = signal('counter.html')
  const local = signal(examples)
  const exs = ()=>examples
  const content = signal('<!DOCTYPE html>\n<h1>Hello</h1>')
  effect(()=>{
    const s = src()
  })
  const doodle = resource(()=>({src:src(),file:file()}), async (r) => {
    console.log('doodle',r)
    if (r.src==='example') {
      const html = await (await fetch('/example/'+r.file)).text()
      content(html)
    } else {
      console.log('local')
    }
  })
  const ref = e => {
    Array.from(document.querySelectorAll('button.playground'))
      .map(n => n.addEventListener('click', _ => playing(b=>!b)))
    const main = document.querySelector('main'), nav = document.querySelector('nav')
    const show = () => (e.classList.add('flex'),e.classList.remove('hidden'), main.classList.add('hidden'), nav.classList.add('hidden'), nav.classList.remove('flex'))
    const hide = () => (e.classList.remove('flex'),e.classList.add('hidden'), main.classList.remove('hidden'), nav.classList.remove('hidden'), nav.classList.add('flex'))
    effect(() => playing() ? show() : hide())
  }
  return h('.flex.w-full.h-full',{ref,style:'background-color:var(--neutral-100)'},[
    h(Show, {when:show}, h(SideMenu, {show:()=>show,src:()=>src,file:()=>file,local:()=>local})),
    h('.flex.column.grow.items-stretch', [
      h(TopMenu, {playing:()=>playing, show:()=>show}),
      h('.flex.grow', [
        h(Editor,{value:()=>content,src:()=>src,file:()=>file}),
        h(Preview,{value:()=>content})
      ])
    ])
  ])
}

render(Playground, window.playground)

</script>
